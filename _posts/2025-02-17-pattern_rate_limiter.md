---
title: Rate Limiter
date: 2025-02-17 00:10:00 +0900
categories: [SystemArchitecture, Pattern]
tags: [system-architecture, pattern]
---


## 특징
Rate Limiter는 특정 시간 동안 허용되는 요청의 수를 제한하는 장치이다.  
주로 서버나 API가 지나치게 많은 요청을 받지 않도록 보호하고, 자원의 과도한 사용을 방지하는 역할을 한다.  
Rate Limiter는 주로 트래픽 관리, 자원 보호, API 제한과 같은 목적으로 사용된다.  
- API 호출 제한: 외부 개발자나 애플리케이션이 공용 API를 사용할 때, 과도한 사용을 방지  
- 웹 서버 보호: 웹 서버에서 트래픽을 제어하여, 서버가 과부하에 걸리지 않도록 하고, 서버 리소스를 보호
- DDoS 공격 방어: 공격자가 서버에 대량의 요청을 보내서 시스템을 마비시키려는 공격을 방어

## 알고리즘

### 1. Token Bucket
요청을 보내기 위해서는 '토큰'을 소모해야 하며, 일정 시간마다 토큰이 다시 채워진다.  
예를 들어, 초당 하나의 토큰이 채워지면, 1초당 1개의 요청을 보낼 수 있으며, 버킷에 남은 토큰이 없다면 요청을 처리하지 못한다.  
API 호출 제한, 서비스의 트래픽을 부드럽게 관리하는 데 유용하다.  

- 장점:
  - 요청이 burst(갑작스러운 증가)로 발생하는 경우에도 이를 허용할 수 있는 유연성이 있음
  - 네트워크에서 많이 사용되는 방식으로 실시간 트래픽 관리에 적합함
- 단점:
  - 구현이 상대적으로 복잡함
  - 메모리 및 계산 자원이 더 많이 필요함

### 2. Leaky Bucket
요청은 버킷에 담겨 일정 속도로 빠져나가고, 버킷이 가득 차면 더 이상 요청을 받을 수 없다.  
시간당 처리 가능한 요청 속도가 일정하게 유지된다.  
네트워크 트래픽 제어, 서버에 균등한 트래픽을 제공하려는 경우 사용됨.  

- 장점:
  - 안정적이고 균일한 속도로 트래픽을 처리할 수 있음
  - 네트워크 대역폭 제한에 적합함
- 단점:
  - 버스트 요청 처리에는 적합하지 않음
  - 유연성이 떨어짐

### 3. Fixed Window Counter
일정 시간(예: 1분) 동안 처리할 수 있는 요청 수를 설정하고, 해당 시간 동안 초가된 요청은 거부한다.  
간단하고 직관적인 방법이지만, 경계에서의 순간적인 폭주가 있을 수 있다.  
일정 시간 동안의 API 호출 제한에 적합하다.  

- 장점:
  - 구현이 간단하며 메모리 및 자원 소모가 적음
  - 각 윈도우 내에서 정확하게 제한을 걸 수 있음
- 단점:
  - 윈도우 경계에서 버스트 트래픽이 발생할 수 있음  
    (1분이 끝나는 순간과 새로운 1분이 시작되는 경계에서 짧은 시간에 많은 요청이 발생할 수 있음)

### 4. Sliding Window Log
일정 시간 동안의 요청을 로그로 기록하여, 실시간으로 요청을 제한한다.  
요청을 더 정교하게 제한할 수 있으며, Fixed Window보다 정확한 트래픽 제어가 가능하다.  
더 정밀한 요청 제한이 필요한 경우에 유용하다.  

- 장점:
  - 경계 문제 없이 더 부드러운 속도 제한이 가능함
  - 정확한 제한을 걸 수 있음
- 단점:
  - 모든 요청의 타임스탬프를 저장해야 하므로, 요청이 많을 경우 메모리 사용량이 증가함

### 5. Sliding Window Counter
일정 시간 간격을 여러 개의 작은 시간 구간으로 나누고, 각 구간에서 발생한 요청 수를 추적하여 제한하는 방식.  
일정 시간 창을 이동시키면서 요청을 카운트하는 방식으로, 고정된 시간 창에서 발생할 수 있는 순간적인 폭주를 방지하는 데 유용하다.  
예를 들어, 1분을 6개의 10초 구간으로 나누고, 각 구간에 대해 최대 10개의 요청을 허용한다고 설정하면,  
각 10초 구간 동안의 요청 수를 추적하면서 전체 1분 동안 요청을 제한한다.  
API 호출 제한, 고정된 시간 창에서는 과도한 요청이 몰리는 문제가 있을 때 유용하다.

- 장점:
  - 고정 윈도우의 간단함과 슬라이딩 윈도우의 부드러움을 결합한 방식
  - 메모리 효율적이고 경계 문제를 어느 정도 해결함
- 단점:
  - 구현이 복잡할 수 있으며, 정확한 카운팅이 필요함

## 결론
Rate Limiter는 트래픽을 효과적으로 관리하고, 서비스의 안정성을 유지하는 중요한 역할을 한다.  
다양한 알고리즘을 통해 사용자의 요구 사항과 환경에 맞는 방식으로 요청을 제어할 수 있다.  
특히, API나 서버 리소스를 보호하고, 악의적인 트래픽으로부터 시스템을 방어하는 데 필수적인 기술이다.  
위에서 다룬 알고리즘들은 각기 다른 상황에서 최적의 성능을 발휘할 수 있으며, 상황에 맞는 적절한 알고리즘을 선택하여 사용해야 한다.  
